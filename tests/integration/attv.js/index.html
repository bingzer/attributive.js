<html>
<head>
	<title>Test Usage</title>
</head>
<body>
    <div style="margin: 10px; border: 1px solid gray">
        <h2>Simple</h2>
        <div data-hello="default">
            <!-- Hello World here-->
        </div>
        <div data-hello="es6">
            <!-- Hello World here-->
        </div>
        <div data-hello="es5">
            <!-- Hello World here-->
        </div>
        <div data-hello="invalid">
            <!-- Hello World here-->
        </div>
        <div data-hello="refresh">
            <!-- Hello World here-->
        </div>
    </div>

    <div style="margin: 10px; border: 1px solid gray">
        <h2>Delay replace</h2>
        <div id="test-div" data-delay="default" data-settings="{timer: 2000}">
            <p style="color: gray">This part is going to get replaced within 2 seconds</p>
        </div>
        <div id="test-div" data-delay="default" data-settings="{timer: 5000}">
            <p style="color: gray">This part is going to get replaced within 5 seconds</p>
        </div>
        <div id="test-div" data-delay="default">
            <p style="color: gray">This part is not going to get replaced because it's missing data-settings</p>
        </div>
    </div>

    <div style="margin: 10px; border: 1px solid gray">
        <h2>Delay register</h2>
        <div id="test-div" data-register="default">
            <p>This part is going to get replaced within 2 seconds</p>
        </div>
    </div>
    
    <script type="text/javascript" src="/build/attv.js"></script>
    <script type="text/javascript" defer>

Attv.register('data-hello', { isAutoLoad: true, wildcard: 'none' }, function (att) {

    att.map('default', function (value, element) {
        element.innerHTML = 'hello. this is from default ' + this.toString();
    });

    att.map('refresh', function (value, element) {
        var that = this;
        var ckounter = 0;
        var ckint = window.setInterval(function () {
            element.innerHTML = 'hello. this is from refresh ' + that.toString() + '. Counter = ' + ckounter++;
            if (ckounter > 20) {
                window.clearInterval(ckint);
            }
        }, 500);
    });

    // -- using ES6 class

    class Es6Class extends Attv.AttributeValue {
        constructor() {
            super("es6");
        }

        load = function (element) {
            element.innerHTML = 'hello. Es6Class. from attribute ' + this.toString();
        }
    }

    att.map(att => new Es6Class());


    // -- using ES5 class

    function Es5Class() {
        Attv.AttributeValue.call(this, 'es5');

        return this;
    }
    Es5Class.prototype = Object.create(Attv.AttributeValue.prototype);
    Es5Class.prototype.load = function (element) {
        element.innerHTML = 'hello. Es5Class. from attribute ' + this.toString();
        return false;
    };

    att.map(att => new Es5Class());

});

Attv.register('data-delay', { isAutoLoad: true }, function (att) {

    att.map('default', function (value, element) {
        value.validators = [ { name: "RequiringAttributeKeys", options: { keys: [ 'data-settings' ] } }];

        var that = this;
        var setting = value.attribute.getSettings(element);
        window.setTimeout(function () {
            element.innerHTML = '<p>This is a delay load from ' + that.toString() + '. after timeout: ' + setting.timer + '</p>';
        }, setting.timer);
    });
});


window.setTimeout(() => {
    Attv.register('data-delay-register', { isAutoLoad: true, attributeName: 'data-register' }, function (att) {

        att.map('default', function (value, element) {
            element.innerHTML = 'This is a delay register from ' + this.toString();
        });
    });

    Attv.Registrar.run();
}, 2000);
    </script>
</body>
</html>